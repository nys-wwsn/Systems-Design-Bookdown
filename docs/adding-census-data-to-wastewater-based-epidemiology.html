<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Adding Census Data to Wastewater-Based Epidemiology | Systems Design for Wastewater Surveillance: Information Guide and Training Resources</title>
  <meta name="description" content="This is a training guide for wastewater surveillance systems design." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Adding Census Data to Wastewater-Based Epidemiology | Systems Design for Wastewater Surveillance: Information Guide and Training Resources" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/logo1.jpg" />
  <meta property="og:description" content="This is a training guide for wastewater surveillance systems design." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Adding Census Data to Wastewater-Based Epidemiology | Systems Design for Wastewater Surveillance: Information Guide and Training Resources" />
  
  <meta name="twitter:description" content="This is a training guide for wastewater surveillance systems design." />
  <meta name="twitter:image" content="/images/logo1.jpg" />

<meta name="author" content="Dustin T. Hill, Shaz Damani, David A. Larsen, and contributions from the New York State Wastewater Surveillance Program" />


<meta name="date" content="2025-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"/>
<link rel="next" href="adding-other-spatial-data-to-wbe.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class-"toc-logo"><a href="./"><img src=images/logo1.jpg></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contact-information"><i class="fa fa-check"></i><b>1.1</b> Contact information</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-new-york-state-mapped-their-sewersheds.html"><a href="how-new-york-state-mapped-their-sewersheds.html"><i class="fa fa-check"></i><b>2</b> How New York State mapped their sewersheds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="how-new-york-state-mapped-their-sewersheds.html"><a href="how-new-york-state-mapped-their-sewersheds.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a></li>
<li class="chapter" data-level="2.2" data-path="how-new-york-state-mapped-their-sewersheds.html"><a href="how-new-york-state-mapped-their-sewersheds.html#goals-for-this-section"><i class="fa fa-check"></i><b>2.2</b> Goals for this section</a></li>
<li class="chapter" data-level="2.3" data-path="how-new-york-state-mapped-their-sewersheds.html"><a href="how-new-york-state-mapped-their-sewersheds.html#resources"><i class="fa fa-check"></i><b>2.3</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><i class="fa fa-check"></i><b>3</b> Maps and spatial data for communities connected to public sewer</a>
<ul>
<li class="chapter" data-level="3.1" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#overview"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#goals-for-this-section-1"><i class="fa fa-check"></i><b>3.2</b> Goals for this section</a></li>
<li class="chapter" data-level="3.3" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#resources-1"><i class="fa fa-check"></i><b>3.3</b> Resources</a></li>
<li class="chapter" data-level="3.4" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#training-exercise"><i class="fa fa-check"></i><b>3.4</b> Training exercise</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#step-1---install-and-load-the-necessary-r-packages"><i class="fa fa-check"></i><b>3.4.1</b> Step 1 - Install and load the necessary R packages</a></li>
<li class="chapter" data-level="3.4.2" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#step-2---load-the-data-into-your-r-session"><i class="fa fa-check"></i><b>3.4.2</b> Step 2 - Load the data into your R session</a></li>
<li class="chapter" data-level="3.4.3" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#step-3---filter-the-wwtp-data-for-municipal-sites-only"><i class="fa fa-check"></i><b>3.4.3</b> Step 3 - Filter the WWTP data for municipal sites only</a></li>
<li class="chapter" data-level="3.4.4" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#step-4---filter-the-parcel-data-for-public-sewer-only"><i class="fa fa-check"></i><b>3.4.4</b> Step 4 - Filter the parcel data for public sewer only</a></li>
<li class="chapter" data-level="3.4.5" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#step-5---link-sewer-parcels-to-towns-and-villages"><i class="fa fa-check"></i><b>3.4.5</b> Step 5 - Link sewer parcels to towns and villages</a></li>
<li class="chapter" data-level="3.4.6" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#step-6---assign-polygons-to-wwtps"><i class="fa fa-check"></i><b>3.4.6</b> Step 6 - Assign polygons to WWTPs</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#training-review"><i class="fa fa-check"></i><b>3.5</b> Training review</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#appendix-1---special-districts"><i class="fa fa-check"></i><b>3.5.1</b> Appendix 1 - Special districts</a></li>
<li class="chapter" data-level="3.5.2" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#appendix-2---create-polygons-using-census-blocks"><i class="fa fa-check"></i><b>3.5.2</b> Appendix 2 - create polygons using census blocks</a></li>
<li class="chapter" data-level="3.5.3" data-path="maps-and-spatial-data-for-communities-connected-to-public-sewer.html"><a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html#appendix-3---polygons-from-point-data"><i class="fa fa-check"></i><b>3.5.3</b> Appendix 3 - Polygons from point data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html"><i class="fa fa-check"></i><b>4</b> Adding Census Data to Wastewater-Based Epidemiology</a>
<ul>
<li class="chapter" data-level="4.1" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#overview-1"><i class="fa fa-check"></i><b>4.1</b> Overview</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#install-and-load-r-packages"><i class="fa fa-check"></i><b>4.1.1</b> Install and Load R packages</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#load-wastewater-data"><i class="fa fa-check"></i><b>4.2</b> Load wastewater data</a></li>
<li class="chapter" data-level="4.3" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#load-us-census-data-method---tidy-census"><i class="fa fa-check"></i><b>4.3</b> Load US Census data method - Tidy Census</a></li>
<li class="chapter" data-level="4.4" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#adding-the-census-data-to-the-wastewater-data"><i class="fa fa-check"></i><b>4.4</b> Adding the Census data to the wastewater data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#spatial-transformations"><i class="fa fa-check"></i><b>4.4.1</b> Spatial transformations</a></li>
<li class="chapter" data-level="4.4.2" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#spatial-intersection"><i class="fa fa-check"></i><b>4.4.2</b> Spatial intersection</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="adding-census-data-to-wastewater-based-epidemiology.html"><a href="adding-census-data-to-wastewater-based-epidemiology.html#training-review-1"><i class="fa fa-check"></i><b>4.5</b> Training review</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adding-other-spatial-data-to-wbe.html"><a href="adding-other-spatial-data-to-wbe.html"><i class="fa fa-check"></i><b>5</b> Adding other spatial data to WBE</a>
<ul>
<li class="chapter" data-level="5.1" data-path="adding-other-spatial-data-to-wbe.html"><a href="adding-other-spatial-data-to-wbe.html#overview-2"><i class="fa fa-check"></i><b>5.1</b> Overview</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="adding-other-spatial-data-to-wbe.html"><a href="adding-other-spatial-data-to-wbe.html#install-and-load-r-packages-1"><i class="fa fa-check"></i><b>5.1.1</b> Install and Load R packages</a></li>
<li class="chapter" data-level="5.1.2" data-path="adding-other-spatial-data-to-wbe.html"><a href="adding-other-spatial-data-to-wbe.html#load-data-into-r"><i class="fa fa-check"></i><b>5.1.2</b> Load data into R</a></li>
<li class="chapter" data-level="5.1.3" data-path="adding-other-spatial-data-to-wbe.html"><a href="adding-other-spatial-data-to-wbe.html#intersect-zip-code-tas-with-sewersheds"><i class="fa fa-check"></i><b>5.1.3</b> Intersect zip code TAs with sewersheds</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="adding-other-spatial-data-to-wbe.html"><a href="adding-other-spatial-data-to-wbe.html#training-review-2"><i class="fa fa-check"></i><b>5.2</b> Training review</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html"><i class="fa fa-check"></i><b>6</b> System design for outbreak detection</a>
<ul>
<li class="chapter" data-level="6.1" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#where-does-wastewater-surveillance-fit-into-the-surveillance-landscape"><i class="fa fa-check"></i><b>6.1</b> Where does wastewater surveillance fit into the surveillance landscape?</a></li>
<li class="chapter" data-level="6.2" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#estimating-sensitivity-of-detection"><i class="fa fa-check"></i><b>6.2</b> Estimating sensitivity of detection</a></li>
<li class="chapter" data-level="6.3" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#equity-of-outbreak-detection"><i class="fa fa-check"></i><b>6.3</b> Equity of outbreak detection</a></li>
<li class="chapter" data-level="6.4" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#example-polio-in-nys"><i class="fa fa-check"></i><b>6.4</b> Example: Polio in NYS</a></li>
<li class="chapter" data-level="6.5" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#considerations-for-designing-wastewater-surveillance-systems-for-outbreak-detection"><i class="fa fa-check"></i><b>6.5</b> Considerations for designing wastewater surveillance systems for outbreak detection</a></li>
<li class="chapter" data-level="6.6" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#conclusion-and-training-review"><i class="fa fa-check"></i><b>6.6</b> Conclusion and training review</a></li>
<li class="chapter" data-level="6.7" data-path="system-design-for-outbreak-detection.html"><a href="system-design-for-outbreak-detection.html#references"><i class="fa fa-check"></i><b>6.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="resources-and-links.html"><a href="resources-and-links.html"><i class="fa fa-check"></i><b>7</b> Resources and links</a>
<ul>
<li class="chapter" data-level="7.1" data-path="resources-and-links.html"><a href="resources-and-links.html#training-videos"><i class="fa fa-check"></i><b>7.1</b> Training Videos</a></li>
<li class="chapter" data-level="7.2" data-path="resources-and-links.html"><a href="resources-and-links.html#data"><i class="fa fa-check"></i><b>7.2</b> Data</a></li>
<li class="chapter" data-level="7.3" data-path="resources-and-links.html"><a href="resources-and-links.html#other-resources"><i class="fa fa-check"></i><b>7.3</b> Other Resources</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Systems Design for Wastewater Surveillance: Information Guide and Training Resources</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="adding-census-data-to-wastewater-based-epidemiology" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Adding Census Data to Wastewater-Based Epidemiology<a href="adding-census-data-to-wastewater-based-epidemiology.html#adding-census-data-to-wastewater-based-epidemiology" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Overview<a href="adding-census-data-to-wastewater-based-epidemiology.html#overview-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Wastewater-based epidemiology (WBE) data can be enhanced by adding other public data sources. One source is United States Census (US Census) data, which can add population demographic variables to WBE data, This vignette demonstrates how to take a spatial WBE dataset of sewershed boundaries in New York State (NYS) and add US Census data using spatial intersection methods.</p>
<div id="install-and-load-r-packages" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Install and Load R packages<a href="adding-census-data-to-wastewater-based-epidemiology.html#install-and-load-r-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Install packages to your computer.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb18-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb18-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb18-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidycensus&quot;</span>)</span>
<span id="cb18-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;units&quot;</span>)</span></code></pre></div>
<p>Load packages into your R session.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># data wrangling</span></span>
<span id="cb19-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># spatial data manipulation</span></span>
<span id="cb19-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># making plots and maps</span></span>
<span id="cb19-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus) <span class="co"># download tabular census data</span></span>
<span id="cb19-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris) <span class="co"># download spatial census data</span></span>
<span id="cb19-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># data wrangling</span></span>
<span id="cb19-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units) <span class="co"># handling variables with unit assignment</span></span></code></pre></div>
</div>
</div>
<div id="load-wastewater-data" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Load wastewater data<a href="adding-census-data-to-wastewater-based-epidemiology.html#load-wastewater-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sewershed boundaries for NYS can be downloaded from <a href="https://www.arcgis.com/home/item.html?id=e795007660ae4a1fae5f86b40d065b3a">ArcGIS online</a>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the boundaries</span></span>
<span id="cb20-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb20-2" aria-hidden="true" tabindex="-1"></a>sewersheds <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/New York State Sewersheds/New York State Sewersheds.shp&quot;</span>)</span>
<span id="cb20-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># select the variables we want to keep</span></span>
<span id="cb20-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb20-5" aria-hidden="true" tabindex="-1"></a>sewersheds <span class="ot">&lt;-</span> sewersheds <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(County, City, WWTP_ID, WWTP, Sewershed, SW_ID, geometry)</span></code></pre></div>
<p>Map your data.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot to view the data</span></span>
<span id="cb21-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb21-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sewersheds, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb21-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/plot%20sewersheds-1.png" width="672" /></p>
</div>
<div id="load-us-census-data-method---tidy-census" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Load US Census data method - Tidy Census<a href="adding-census-data-to-wastewater-based-epidemiology.html#load-us-census-data-method---tidy-census" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>US Census data can be added to your R session using the packages <code>tidycensus</code> and <code>tigris</code>. Both packages connect to the US Census API for downloading tabular data or spatial boundaries. You will need an API key to access the data. For information on obtaining a key, visit the <code>tidycensus</code> <a href="https://walker-data.com/tidycensus/reference/census_api_key.html">website</a>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve your API key if stored in the environment</span></span>
<span id="cb22-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="fu">Sys.getenv</span>(<span class="st">&#39;CENSUS_API_KEY&#39;</span>))</span></code></pre></div>
<p>For this example, we are going to download 2020 decennial census data and calculate the total number of individuals that self-identify as black or African American from that year. We will calculate totals and percentage of total population. We are going to use census tracts as our geography.</p>
<p>To download the data, we need to know the name of the variables we want and for that, we use the <code>load_variables</code> command.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the variable names into an R object. cache = TRUE can speed the data download step in the next portion</span></span>
<span id="cb23-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb23-2" aria-hidden="true" tabindex="-1"></a>census_var_names <span class="ot">&lt;-</span> <span class="fu">load_variables</span>(<span class="at">year =</span> <span class="dv">2020</span>, <span class="at">dataset =</span> <span class="st">&quot;pl&quot;</span>, <span class="at">cache =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the first few rows of data</span></span>
<span id="cb24-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(census_var_names)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   name    label                                             concept         
##   &lt;chr&gt;   &lt;chr&gt;                                             &lt;chr&gt;           
## 1 H1_001N &quot; !!Total:&quot;                                       OCCUPANCY STATUS
## 2 H1_002N &quot; !!Total:!!Occupied&quot;                             OCCUPANCY STATUS
## 3 H1_003N &quot; !!Total:!!Vacant&quot;                               OCCUPANCY STATUS
## 4 P1_001N &quot; !!Total:&quot;                                       RACE            
## 5 P1_002N &quot; !!Total:!!Population of one race:&quot;              RACE            
## 6 P1_003N &quot; !!Total:!!Population of one race:!!White alone&quot; RACE</code></pre>
<p>This function can load the variable names for many datasets from the US Census and provides the name, the variable description, and the concept group that the variable is part of. Looking at the options, we can see that we want a variable from the <code>RACE</code> concept, specifically, <code>P1_004N</code>, which is “!!Total:!!Population of one race:!!Black or African American alone”. For this exercise, we will not be included those that identify as multiple racial or ethnic groups, but you can adapt the methods presented to make those calculations.</p>
<p>To get the total for each census tract that identify as black or African American, we need this variable. However, to calculate the percent of the population, we also need the total population, which is the variable ” !!Total:” or <code>P1_001N</code>. We will use the <code>get_dencennial</code> function to download the data into our R session.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the decennial data for the tract geography for NYS</span></span>
<span id="cb26-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-2" aria-hidden="true" tabindex="-1"></a>census_data <span class="ot">&lt;-</span> <span class="fu">get_decennial</span>(</span>
<span id="cb26-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb26-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">geography =</span> <span class="st">&quot;tract&quot;</span>,</span>
<span id="cb26-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">&quot;New York&quot;</span>,</span>
<span id="cb26-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(</span>
<span id="cb26-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="at">population_total =</span> <span class="st">&quot;P1_001N&quot;</span>),</span>
<span id="cb26-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_alone =</span> <span class="st">&quot;P1_004N&quot;</span></span>
<span id="cb26-9"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-10"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb26-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># view the first few rows of data</span></span>
<span id="cb27-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(census_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   GEOID       NAME                                       variable         value
##   &lt;chr&gt;       &lt;chr&gt;                                      &lt;chr&gt;            &lt;dbl&gt;
## 1 36001000100 Census Tract 1, Albany County, New York    population_total  2073
## 2 36001000201 Census Tract 2.01, Albany County, New York population_total  3125
## 3 36001000202 Census Tract 2.02, Albany County, New York population_total  2598
## 4 36001000301 Census Tract 3.01, Albany County, New York population_total  3190
## 5 36001000302 Census Tract 3.02, Albany County, New York population_total  3496
## 6 36001000401 Census Tract 4.01, Albany County, New York population_total  2216</code></pre>
<p>The resulting dataset is now in our R session with 10,822 rows. We will need to pivot the dataframe to a wider format because it placed the variables in a long format.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot the data from long to wide format</span></span>
<span id="cb29-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb29-2" aria-hidden="true" tabindex="-1"></a>census_data <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(census_data,</span>
<span id="cb29-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb29-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">names_from =</span> variable)</span>
<span id="cb29-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of the dataset variables</span></span>
<span id="cb29-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(census_data)</span></code></pre></div>
<pre><code>##     GEOID               NAME           population_total  black_alone    
##  Length:5411        Length:5411        Min.   :    0    Min.   :   0.0  
##  Class :character   Class :character   1st Qu.: 2490    1st Qu.:  47.5  
##  Mode  :character   Mode  :character   Median : 3578    Median : 164.0  
##                                        Mean   : 3733    Mean   : 551.9  
##                                        3rd Qu.: 4762    3rd Qu.: 667.0  
##                                        Max.   :17222    Max.   :7935.0</code></pre>
<p>Now we have census counts for individuals that self-identify as black or African American and we want to add these data to our wastewater sewershed boundaries. To do this, we need to add the census geometry (the spatial component) to the R session.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download tracts for NY for 2020 and drop the name column</span></span>
<span id="cb31-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb31-2" aria-hidden="true" tabindex="-1"></a>tracts <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="at">state =</span> <span class="st">&quot;New York&quot;</span>, <span class="at">year =</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>NAME) </span>
<span id="cb31-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># join the tract geometries to the census data</span></span>
<span id="cb31-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb31-5" aria-hidden="true" tabindex="-1"></a>census_data_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tracts, census_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;GEOID&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data structure</span></span>
<span id="cb32-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(census_data_sf)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   5411 obs. of  15 variables:
##  $ STATEFP         : chr  &quot;36&quot; &quot;36&quot; &quot;36&quot; &quot;36&quot; ...
##  $ COUNTYFP        : chr  &quot;047&quot; &quot;047&quot; &quot;047&quot; &quot;047&quot; ...
##  $ TRACTCE         : chr  &quot;000700&quot; &quot;000900&quot; &quot;001100&quot; &quot;001300&quot; ...
##  $ GEOID           : chr  &quot;36047000700&quot; &quot;36047000900&quot; &quot;36047001100&quot; &quot;36047001300&quot; ...
##  $ NAMELSAD        : chr  &quot;Census Tract 7&quot; &quot;Census Tract 9&quot; &quot;Census Tract 11&quot; &quot;Census Tract 13&quot; ...
##  $ MTFCC           : chr  &quot;G5020&quot; &quot;G5020&quot; &quot;G5020&quot; &quot;G5020&quot; ...
##  $ FUNCSTAT        : chr  &quot;S&quot; &quot;S&quot; &quot;S&quot; &quot;S&quot; ...
##  $ ALAND           : num  176774 163469 168507 293167 154138 ...
##  $ AWATER          : num  0 0 0 0 0 ...
##  $ INTPTLAT        : chr  &quot;+40.6923505&quot; &quot;+40.6917206&quot; &quot;+40.6932903&quot; &quot;+40.6976150&quot; ...
##  $ INTPTLON        : chr  &quot;-073.9973434&quot; &quot;-073.9916018&quot; &quot;-073.9877087&quot; &quot;-073.9883586&quot; ...
##  $ NAME            : chr  &quot;Census Tract 7, Kings County, New York&quot; &quot;Census Tract 9, Kings County, New York&quot; &quot;Census Tract 11, Kings County, New York&quot; &quot;Census Tract 13, Kings County, New York&quot; ...
##  $ population_total: num  4415 5167 1578 2465 1694 ...
##  $ black_alone     : num  151 197 178 234 172 ...
##  $ geometry        :sfc_MULTIPOLYGON of length 5411; first list element: List of 1
##   ..$ :List of 1
##   .. ..$ : num [1:35, 1:2] -74 -74 -74 -74 -74 ...
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##   ..- attr(*, &quot;names&quot;)= chr [1:14] &quot;STATEFP&quot; &quot;COUNTYFP&quot; &quot;TRACTCE&quot; &quot;GEOID&quot; ...</code></pre>
</div>
<div id="adding-the-census-data-to-the-wastewater-data" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Adding the Census data to the wastewater data<a href="adding-census-data-to-wastewater-based-epidemiology.html#adding-the-census-data-to-the-wastewater-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="spatial-transformations" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Spatial transformations<a href="adding-census-data-to-wastewater-based-epidemiology.html#spatial-transformations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To add our population data to the sewershed data, we have a few steps to complete. First, both of our datasets need to be the same spatial projection so that they spatially overlap and can be mapped on top of each other.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform the census data CRS to match the sewersheds</span></span>
<span id="cb34-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-2" aria-hidden="true" tabindex="-1"></a>census_data_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(census_data_sf, <span class="fu">st_crs</span>(sewersheds))</span>
<span id="cb34-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the data, the layers should overlap</span></span>
<span id="cb34-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb34-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> census_data_sf, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sewersheds, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/spatial%20transformation-1.png" width="672" /></p>
</div>
<div id="spatial-intersection" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Spatial intersection<a href="adding-census-data-to-wastewater-based-epidemiology.html#spatial-intersection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we want to spatially intersect the data. This will assign census count data to the sewersheds that overlap. Sewershed boundaries do not follow census tract boundaries closely, so we have two options for assigning the data. First, we can apportion census data to the sewersheds using the proportion of each census tract area that is within the sewershed area. Alternatively, we can assign the total population for all intersecting tracts to the sewershed.</p>
<p>The first method, called areal apportionment, is generally thought to provide more accurate methods for counts of the data, but assumes that people are evenly distributed within the census tract. The second method could be useful if it is not known how evenly the population is distributed and you want to avoid excluding anyone. We will practice both methods.</p>
<div id="areal-apportionment" class="section level4 hasAnchor" number="4.4.2.1">
<h4><span class="header-section-number">4.4.2.1</span> Areal apportionment<a href="adding-census-data-to-wastewater-based-epidemiology.html#areal-apportionment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the area of each census tract. Note this field becomes a unit </span></span>
<span id="cb35-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variable, we will have to drop those later</span></span>
<span id="cb35-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-3" aria-hidden="true" tabindex="-1"></a>census_data_sf<span class="sc">$</span>tract_area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(census_data_sf)</span>
<span id="cb35-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># turn of spherical geometry to handle overlapping edges and invalid vertices </span></span>
<span id="cb35-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># warnings</span></span>
<span id="cb35-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-7" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb35-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect both datasets, creating a new dataset that has slivers of each tract</span></span>
<span id="cb35-10"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># that intersects a sewershed</span></span>
<span id="cb35-11"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-11" aria-hidden="true" tabindex="-1"></a>intersection <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(sewersheds, census_data_sf)</span>
<span id="cb35-12"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(intersection)</span></code></pre></div>
<pre><code>##     County              City             WWTP_ID              WWTP          
##  Length:7963        Length:7963        Length:7963        Length:7963       
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##   Sewershed            SW_ID             STATEFP            COUNTYFP        
##  Length:7963        Length:7963        Length:7963        Length:7963       
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##    TRACTCE             GEOID             NAMELSAD            MTFCC          
##  Length:7963        Length:7963        Length:7963        Length:7963       
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##    FUNCSTAT             ALAND               AWATER            INTPTLAT        
##  Length:7963        Min.   :0.000e+00   Min.   :0.000e+00   Length:7963       
##  Class :character   1st Qu.:2.136e+05   1st Qu.:0.000e+00   Class :character  
##  Mode  :character   Median :1.176e+06   Median :0.000e+00   Mode  :character  
##                     Mean   :1.933e+07   Mean   :2.107e+06                     
##                     3rd Qu.:6.154e+06   3rd Qu.:1.536e+05                     
##                     Max.   :1.828e+09   Max.   :1.997e+09                     
##    INTPTLON             NAME           population_total  black_alone    
##  Length:7963        Length:7963        Min.   :    0    Min.   :   0.0  
##  Class :character   Class :character   1st Qu.: 2593    1st Qu.:  61.0  
##  Mode  :character   Mode  :character   Median : 3672    Median : 211.0  
##                                        Mean   : 3803    Mean   : 587.3  
##                                        3rd Qu.: 4824    3rd Qu.: 734.5  
##                                        Max.   :17222    Max.   :7935.0  
##    tract_area                      geometry   
##  Min.   :2.169e+04   GEOMETRYCOLLECTION:  28  
##  1st Qu.:2.261e+05   MULTIPOLYGON      :1583  
##  Median :1.277e+06   POLYGON           :6352  
##  Mean   :2.140e+07   epsg:4269         :   0  
##  3rd Qu.:6.565e+06   +proj=long...     :   0  
##  Max.   :1.993e+09</code></pre>
<p>Our spatial data are now combined into one spatial data object.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate a new area for each sliver</span></span>
<span id="cb37-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb37-2" aria-hidden="true" tabindex="-1"></a>intersection<span class="sc">$</span>sliver_area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(intersection)</span>
<span id="cb37-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the proportion of area that each sliver occupies in the sewershed</span></span>
<span id="cb37-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb37-5" aria-hidden="true" tabindex="-1"></a>intersection<span class="sc">$</span>prop_area <span class="ot">&lt;-</span> intersection<span class="sc">$</span>sliver_area <span class="sc">/</span> intersection<span class="sc">$</span>tract_area</span>
<span id="cb37-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(intersection<span class="sc">$</span>prop_area)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.06113 0.88439 0.60984 1.00122 1.00216</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You will notice some areas are slightly over 1 representing a rounding error. Let&#39;s make those all 1 to avoid assignment issues</span></span>
<span id="cb39-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># drop units</span></span>
<span id="cb39-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-4" aria-hidden="true" tabindex="-1"></a>intersection<span class="sc">$</span>prop_area <span class="ot">&lt;-</span> <span class="fu">drop_units</span>(intersection<span class="sc">$</span>prop_area)</span>
<span id="cb39-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-5" aria-hidden="true" tabindex="-1"></a>intersection<span class="sc">$</span>prop_area <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(intersection<span class="sc">$</span>prop_area <span class="sc">&gt;</span> <span class="dv">1</span>, </span>
<span id="cb39-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">1</span>, </span>
<span id="cb39-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-7" aria-hidden="true" tabindex="-1"></a>                                 intersection<span class="sc">$</span>prop_area</span>
<span id="cb39-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-8" aria-hidden="true" tabindex="-1"></a>                                 )</span>
<span id="cb39-9"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(intersection<span class="sc">$</span>prop_area)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.06113 0.88439 0.60930 1.00000 1.00000</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># multiply the proportional area by the totals for black or African American and total population to get proportional values</span></span>
<span id="cb41-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-2" aria-hidden="true" tabindex="-1"></a>intersection<span class="sc">$</span>prop_black <span class="ot">&lt;-</span> intersection<span class="sc">$</span>prop_area <span class="sc">*</span> intersection<span class="sc">$</span>black_alone</span>
<span id="cb41-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-3" aria-hidden="true" tabindex="-1"></a>intersection<span class="sc">$</span>prop_population <span class="ot">&lt;-</span> </span>
<span id="cb41-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  intersection<span class="sc">$</span>prop_area <span class="sc">*</span> intersection<span class="sc">$</span>population_total</span>
<span id="cb41-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># how we will group the data by sewershed and sum the total population and total black population in each sewershed</span></span>
<span id="cb41-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-7" aria-hidden="true" tabindex="-1"></a>intersection_final <span class="ot">&lt;-</span> intersection <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(County, City, WWTP_ID, WWTP, Sewershed, SW_ID) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sum_black_alone =</span> <span class="fu">sum</span>(prop_black, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-10"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum_total_population =</span> <span class="fu">sum</span>(prop_population)</span>
<span id="cb41-11"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-11" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb41-12"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb41-13"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># our resulting dataset has 674 rows, one for each sewershed, and proportional estimates for population totals and the total number of individuals that self identify as black or African American</span></span>
<span id="cb41-15"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(intersection_final)</span></code></pre></div>
<pre><code>##     County              City             WWTP_ID              WWTP          
##  Length:674         Length:674         Length:674         Length:674        
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##   Sewershed            SW_ID           sum_black_alone     sum_total_population
##  Length:674         Length:674         Min.   :     0.00   Min.   :      0.2   
##  Class :character   Class :character   1st Qu.:     0.74   1st Qu.:     66.6   
##  Mode  :character   Mode  :character   Median :    12.91   Median :    595.6   
##                                        Mean   :  4932.45   Mean   :  27214.5   
##                                        3rd Qu.:   381.10   3rd Qu.:   7356.8   
##                                        Max.   :307461.96   Max.   :1154606.8   
##                geometry  
##  GEOMETRYCOLLECTION:  2  
##  MULTIPOLYGON      :160  
##  POLYGON           :512  
##  epsg:4269         :  0  
##  +proj=long...     :  0  
## </code></pre>
<p>We have estimated totals, which can be useful, but often, percentage of the population is more informative for analyses. We can get an estimated proportion of the population by dividing the total black alone variable by the total population value.Also, you will notice that the values are no longer integers, meaning that there are estimates for total number of people that include decimals. These can be rounded to the nearest whole number to return the data back to integers.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the proportion</span></span>
<span id="cb43-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-2" aria-hidden="true" tabindex="-1"></a>intersection_final<span class="sc">$</span>prop_black <span class="ot">&lt;-</span> </span>
<span id="cb43-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  intersection_final<span class="sc">$</span>sum_black_alone <span class="sc">/</span> intersection_final<span class="sc">$</span>sum_total_population</span>
<span id="cb43-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the percentages</span></span>
<span id="cb43-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb43-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> intersection_final, <span class="fu">aes</span>(<span class="at">fill =</span> prop_black), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb43-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/areal%20apportionment%204-1.png" width="672" /></p>
</div>
<div id="intersection-assignment" class="section level4 hasAnchor" number="4.4.2.2">
<h4><span class="header-section-number">4.4.2.2</span> Intersection assignment<a href="adding-census-data-to-wastewater-based-epidemiology.html#intersection-assignment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The other method for assigning data is to assign the total population for all census tracts that intersect with a sewershed.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># st_intersects returns a list of the polygon rows that intersect from each </span></span>
<span id="cb44-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># object</span></span>
<span id="cb44-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb44-3" aria-hidden="true" tabindex="-1"></a>intersect_list <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(sewersheds, census_data_sf)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make it a dataframe</span></span>
<span id="cb45-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb45-2" aria-hidden="true" tabindex="-1"></a>intersect_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(intersect_list)</span>
<span id="cb45-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># view the top view rows</span></span>
<span id="cb45-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(intersect_df)</span></code></pre></div>
<pre><code>##   row.id col.id
## 1      1   1142
## 2      1   1145
## 3      1   1146
## 4      1   2664
## 5      1   3692
## 6      1   5333</code></pre>
<p>Column 1 are the row ids for the sewersheds and column 2 are the row ids for the tracts that intersect them. We will add the row ids to each data object, then use those to merge the census counts to the spatial data and sum to totals.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add row ids</span></span>
<span id="cb47-2"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-2" aria-hidden="true" tabindex="-1"></a>sewersheds<span class="sc">$</span>sewer_row_id <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">rownames</span>(sewersheds))</span>
<span id="cb47-3"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-3" aria-hidden="true" tabindex="-1"></a>census_data_sf<span class="sc">$</span>census_row_id <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">rownames</span>(census_data_sf))</span>
<span id="cb47-4"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rename intersect column and merge to spatial sewersheds</span></span>
<span id="cb47-7"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(intersect_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sewer_row_id&quot;</span>, <span class="st">&quot;census_row_id&quot;</span>)</span>
<span id="cb47-8"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-8" aria-hidden="true" tabindex="-1"></a>intersect_combined <span class="ot">&lt;-</span> <span class="fu">full_join</span>(sewersheds, intersect_df, </span>
<span id="cb47-9"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;sewer_row_id&quot;</span>)</span>
<span id="cb47-10"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-10" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb47-11"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># change the census data from a spatial object to a dataframe</span></span>
<span id="cb47-13"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-13" aria-hidden="true" tabindex="-1"></a>census_data_df <span class="ot">&lt;-</span> <span class="fu">st_drop_geometry</span>(census_data_sf)</span>
<span id="cb47-14"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># merge census data -&gt; note that we have to remove the spatial data from the </span></span>
<span id="cb47-16"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># census data</span></span>
<span id="cb47-17"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-17" aria-hidden="true" tabindex="-1"></a>intersect_combined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(intersect_combined, census_data_df, </span>
<span id="cb47-18"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;census_row_id&quot;</span>)</span>
<span id="cb47-19"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-19" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb47-20"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co"># sum the total number of people that are in census tracts intersecting each </span></span>
<span id="cb47-22"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co"># sewershed</span></span>
<span id="cb47-23"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-23" aria-hidden="true" tabindex="-1"></a>intersect_final <span class="ot">&lt;-</span> intersect_combined<span class="sc">%&gt;%</span></span>
<span id="cb47-24"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(County, City, WWTP_ID, WWTP, Sewershed, SW_ID) <span class="sc">%&gt;%</span></span>
<span id="cb47-25"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sum_black_alone =</span> <span class="fu">sum</span>(black_alone, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-26"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum_total_population =</span> <span class="fu">sum</span>(population_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-27"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-27" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb47-28"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb47-29"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the proportions</span></span>
<span id="cb47-31"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-31" aria-hidden="true" tabindex="-1"></a>intersect_final<span class="sc">$</span>prop_black <span class="ot">&lt;-</span> </span>
<span id="cb47-32"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-32" aria-hidden="true" tabindex="-1"></a>  intersect_final<span class="sc">$</span>sum_black_alone <span class="sc">/</span> intersect_final<span class="sc">$</span>sum_total_population</span>
<span id="cb47-33"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="co"># make a map</span></span>
<span id="cb47-35"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb47-36"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> intersect_final, <span class="fu">aes</span>(<span class="at">fill =</span> prop_black), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb47-37"><a href="adding-census-data-to-wastewater-based-epidemiology.html#cb47-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/intersects%203-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="training-review-1" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Training review<a href="adding-census-data-to-wastewater-based-epidemiology.html#training-review-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This tutorial demonstrated a process for adding US Census data to WBE spatial data (sewersheds). We calculated the percentage of each sewershed population that identified as black or African American in the 2020 decennial census. These methods can be used to estimate other data available from the US Census. For more information visit the <a href="https://www.census.gov/">US Census website</a> or <a href="https://walker-data.com/tidycensus/">tidycensus</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="maps-and-spatial-data-for-communities-connected-to-public-sewer.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="adding-other-spatial-data-to-wbe.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-align-with-cenus-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
